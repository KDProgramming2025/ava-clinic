// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Service {
  id           String        @id @default(cuid())
  title        String
  subtitle     String?
  slug         String        @unique
  description  String        @db.Text
  image        String?
  priceRange   String?
  duration     String?
  recovery     String?
  benefits     Benefit[]
  processSteps ProcessStep[]
  faq          Faq[]
  bookings     Booking[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Benefit {
  id        String   @id @default(cuid())
  text      String
  service   Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  serviceId String
}

model ProcessStep {
  id          String   @id @default(cuid())
  stepNumber  Int
  title       String?
  description String   @db.Text
  service     Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  serviceId   String
  @@index([serviceId, stepNumber])
}

model Faq {
  id        String   @id @default(cuid())
  question  String
  answer    String   @db.Text
  service   Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  serviceId String
}

model Testimonial {
  id        String   @id @default(cuid())
  name      String
  text      String   @db.Text
  rating    Int      // 1..5
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TeamMember {
  id        String   @id @default(cuid())
  name      String
  role      String
  bio       String?  @db.Text
  image     String?
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  articles  Article[] @relation("ArticleAuthor")
}

enum ArticleStatus {
  DRAFT
  PUBLISHED
}

enum VideoStatus {
  DRAFT
  PUBLISHED
}

model Category {
  id        String    @id @default(cuid())
  name      String
  slug      String    @unique
  color     String?
  articles  Article[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Tag {
  id        String    @id @default(cuid())
  name      String
  slug      String    @unique
  articles  Article[] @relation("ArticleTags")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Article {
  id              String         @id @default(cuid())
  title           String
  slug            String         @unique
  excerpt         String?
  body            String?        @db.Text
  image           String?
  readTimeMinutes Int?
  status          ArticleStatus  @default(DRAFT)
  featured        Boolean        @default(false)
  publishedAt     DateTime?
  categoryId      String?
  category        Category?      @relation(fields: [categoryId], references: [id])
  authorId        String?
  author          TeamMember?    @relation("ArticleAuthor", fields: [authorId], references: [id])
  tags            Tag[]          @relation("ArticleTags")
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  @@index([categoryId])
  @@index([status])
  @@index([featured])
}

// Phase 2 content & settings

model NavigationItem {
  id        String   @id @default(cuid())
  label     String
  path      String
  order     Int      @default(0)
  visible   Boolean  @default(true)
}

model FooterLink {
  id    String @id @default(cuid())
  label String
  url   String
  group String?
}

model Settings {
  id              Int      @id @default(1)
  siteTitle       String?
  metaDescription String?  @db.Text
  ogImage         String?
  primaryColor    String?
  secondaryColor  String?
  languagesJson   Json?
  logoUrl         String?
  emailConfirmTemplate  String? @db.Text
  emailReminderTemplate String? @db.Text
  contactAutoReply      String? @db.Text
}

model HomeHero {
  id                   Int     @id @default(1)
  title                String?
  subtitle             String?
  description          String? @db.Text
  ctaPrimaryLabel      String?
  ctaSecondaryLabel    String?
}

model HomeStat {
  id     String @id @default(cuid())
  label  String
  value  Int
  icon   String?
}

model HomeFeature {
  id          String @id @default(cuid())
  title       String
  description String? @db.Text
  icon        String?
}

model HomeCTA {
  id         Int    @id @default(1)
  heading    String?
  subheading String?
  buttonLabel String?
}

model AboutTimeline {
  id          String @id @default(cuid())
  year        Int
  title       String
  description String? @db.Text
}

model AboutValue {
  id          String @id @default(cuid())
  title       String
  description String? @db.Text
  icon        String?
}

model AboutSkill {
  id    String @id @default(cuid())
  name  String
  level Int
}

model AboutMission {
  id         Int     @id @default(1)
  heading    String?
  paragraph  String? @db.Text
}

model AboutMissionBullet {
  id       String @id @default(cuid())
  text     String
}

enum ContactInfoType {
  phone
  email
  address
  hours
}

model ContactInfoBlock {
  id     String          @id @default(cuid())
  type   ContactInfoType
  title  String
  values ContactInfoValue[]
}

model ContactInfoValue {
  id       String  @id @default(cuid())
  value    String
  blockId  String
  block    ContactInfoBlock @relation(fields: [blockId], references: [id], onDelete: Cascade)
}

model ContactFaq {
  id       String @id @default(cuid())
  question String
  answer   String @db.Text
}

model SocialLink {
  id       String @id @default(cuid())
  platform String
  url      String
  icon     String?
}

enum QuickActionType {
  call
  email
  chat
  custom
}

model QuickAction {
  id     String          @id @default(cuid())
  label  String
  type   QuickActionType
  target String
}

model Newsletter {
  id          Int    @id @default(1)
  headline    String?
  description String?
  buttonLabel String?
}

model TrendingTopic {
  id    String @id @default(cuid())
  text  String
  order Int    @default(0)
}

// Phase 3 operational models

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum ClientStatus {
  ACTIVE
  INACTIVE
}

enum MessageStatus {
  NEW
  READ
  REPLIED
  ARCHIVED
}

model Client {
  id         String    @id @default(cuid())
  name       String
  email      String?
  phone      String?
  joinDate   DateTime  @default(now())
  lastVisit  DateTime?
  status     ClientStatus @default(ACTIVE)
  notes      String?   @db.Text
  bookings   Booking[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model Booking {
  id         String        @id @default(cuid())
  clientId   String
  client     Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  serviceId  String?
  service    Service?      @relation(fields: [serviceId], references: [id])
  startTime  DateTime
  endTime    DateTime?
  status     BookingStatus @default(PENDING)
  notes      String?       @db.Text
  priceCents Int?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  @@index([clientId])
  @@index([serviceId])
  @@index([status, startTime])
}

model Message {
  id         String        @id @default(cuid())
  fromName   String
  email      String?
  phone      String?
  subject    String?
  body       String        @db.Text
  receivedAt DateTime      @default(now())
  status     MessageStatus @default(NEW)
  starred    Boolean       @default(false)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  @@index([status, receivedAt])
}

model Translation {
  key       String @id
  data      Json
  updatedAt DateTime @updatedAt
}

model VideoCategory {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  videos    Video[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Video {
  id             String       @id @default(cuid())
  title          String
  slug           String?      @unique
  description    String?      @db.Text
  thumbnail      String?
  durationSeconds Int?
  views          Int          @default(0)
  status         VideoStatus  @default(DRAFT)
  categoryId     String?
  category       VideoCategory? @relation(fields: [categoryId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  @@index([categoryId])
  @@index([status])
}

// Phase 4 enhancements: Media library and Admin users (access control)

model Media {
  id        String   @id @default(cuid())
  url       String
  alt       String?
  type      String?
  labels    Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum AdminRole {
  SUPERADMIN
  ADMIN
  EDITOR
  VIEWER
}

model AdminUser {
  id           String    @id @default(cuid())
  email        String    @unique
  name         String?
  role         AdminRole @default(EDITOR)
  passwordHash String
  active       Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}
